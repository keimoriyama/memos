# Docker の学習メモです

(公式ドキュメント（日本語）)[http://docs.docker.jp/index.html]

## ベストプラクティス

### イメージを小さく保つ方法

- 適切なベースイメージで始める（`ubuntu`に`node`をインストールするのではなく、`node`のイメージをベースにする

- マルチステージビルド（？）を使う

- 複数のイメージで共通する部分が多いとき、共通部分のコンポーネントが入ったベースイメージを用意して、それを独自のイメージのベースにする

- わかりやすいタグをつける

- テストとデプロイのために`CI/CD`を導入する

## Dockerfile について

`Docker`は`Dockerfile`から命令を読み込んで、イメージを構築する

イメージを構築するためのコマンドを記述したもの

- 例

```dockerfile
FROM ubuntu:18.04
COPY . /app
RUN make /app
CMD python /app/app.py
```

- `FROM`は`ubuntu:18.04`のイメージからレイヤを作成する

- `CPOY`は現在のディレクトリから Docker クライアントがファイルを追加する

- `RUN`がアプリケーションを`make`コマンドを使って高知行く

- `CMD`はコンテナないで何のコマンドを実行するかを指定する

### Dockerfile 命令

#### FROM

ベースにするイメージの指定

#### RUN

RUN 命令をバックスラッシュで区切ることでわかりやすくする

##### apt-get

いくつかの注意点がある。

- `RUN apt-get upgrade`や`dist-upgrade`の実行はさけてください

権限が与えられていないコンテナではほとんど更新できないため

- `RUN apt-get update`と`apt-get install`は同一の`RUN`コマンドで実行する

キャッシュに問題が発生することがあるのでだめ

#### ADD と COPY

- COPY

COPY はローカルファイルをコンテナにコピーする

- ADD

特定の機能があり、簡単にはわからない
